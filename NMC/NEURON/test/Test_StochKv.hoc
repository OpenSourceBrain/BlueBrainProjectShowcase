usegui = 1

{load_file("stdlib.hoc")}
{load_file("stdgui.hoc")}


create Soma1
create Soma2
create Soma3
create Soma4

access Soma1

celsius = 23

forall {
    pt3dclear() pt3dadd(0.0, 0, 0.0, 13.4715) pt3dadd(0.0, 23.1694, 0.0, 13.4715)
    define_shape()
    Ra = 100
    insert pas 
    { g_pas=3.38e-05 }
    { e_pas=-70 }

}

test_cond_dens =0.000036 
test_cond_dens =0.000211 

Soma2 {
    insert StochKv_deterministic 
    gmax_StochKv_deterministic = test_cond_dens
    ek = -85 
}

objref rng1
Soma3 {
    insert StochKv_det 
    gkbar_StochKv_det = 1e4*test_cond_dens
    /*
    rng1 = new Random()
    rng1.MCellRan4( 1232, 123 )
    rng1.uniform(0,1)
    setdata_StochKv_det(0.5)
    setRNG_StochKv_det(rng1)*/
    
     ek = -85 
}


objref rng2
Soma4 {
    insert StochKv_bbp 
    gkbar_StochKv_bbp = 1e4*test_cond_dens

    rng2 = new Random()
    rng2.MCellRan4( 1232, 123 )
    rng2.uniform(0,1)
    setdata_StochKv_bbp(0.5)
    setRNG_StochKv_bbp(rng2)
    ek = -85 
}


proc initialiseValues0() {

    forall  v = -90

}

objref fih0
{fih0 = new FInitializeHandler(0, "initialiseValues0()")}

objref stim1
objref stim2 
objref stim3 
objref stim4 


Soma1 {
    
    stim1 = new IClamp(0.5)
    stim1.del = 800.0
    stim1.dur = 500.0
    stim1.amp = 0.02
}

Soma2 {
    stim2 = new IClamp(0.5)
    stim2.del = 800.0
    stim2.dur = 500.0
    stim2.amp = 0.02
}
Soma3 {
    stim3 = new IClamp(0.5)
    stim3.del = 800.0
    stim3.dur = 500.0
    stim3.amp = 0.02
}
Soma4 {
    stim4 = new IClamp(0.5)
    stim4.del = 800.0
    stim4.dur = 500.0
    stim4.amp = 0.02
}



tstop = 1600.0
dt = 0.01


objref v_time
objref f_time



objref Soma_v1
{ Soma_v1 = new Vector() }
{ Soma_v1.record(&Soma1.v(0.5))} 


objref GraphWin_0
objref GraphWin_1
objref GraphWin_2
objref GraphWin_3

if (usegui==1) {
    GraphWin_0 = new Graph(0)
    {GraphWin_0.size(0, tstop,-110.0,50.0)}
    {GraphWin_0.view(0, -110.0, tstop, 160.0, 80, 330, 330, 250)}
    {
        GraphWin_0.addexpr("Passive", "Soma1.v(0.5)", 1, 1, 0.8, 0.9, 2)
        GraphWin_0.addexpr("NML2", "Soma2.v(0.5)", 2, 1, 0.8, 0.9, 2)
        GraphWin_0.addexpr("M_Hines", "Soma3.v(0.5)", 3, 1, 0.8, 0.9, 2)
        GraphWin_0.addexpr("BBP", "Soma4.v(0.5)", 4, 1, 0.8, 0.9, 2)
        graphList[0].append(GraphWin_0)
    }

    GraphWin_1 = new Graph(0)
    {GraphWin_1.size(0, tstop,-0.1,1.1)}
    {GraphWin_1.view(0, -0.1, tstop, 1.2, 80, 330, 330, 250)}
    {
        GraphWin_1.addexpr("NML2", "Soma2.n_q_StochKv_deterministic(0.5)", 1, 1, 0.8, 0.9, 2)
        GraphWin_1.addexpr("M_Hines", "Soma3.n_StochKv_det(0.5)", 2, 1, 0.8, 0.9, 2)
        GraphWin_1.addexpr("BBP", "Soma4.N1_StochKv_bbp(0.5)/Soma4.N_StochKv_bbp(0.5)", 3, 1, 0.8, 0.9, 2)
        graphList[0].append(GraphWin_1)
    }

    GraphWin_2 = new Graph(0)
    {GraphWin_2.size(0, tstop,-0.1,1.1)}
    {GraphWin_2.view(0, -0.1e-6, tstop, 3e-5, 80, 330, 330, 250)}
    {
        GraphWin_2.addexpr("NML2", "Soma2.gion_StochKv_deterministic(0.5)", 1, 1, 0.8, 0.9, 2)
        GraphWin_2.addexpr("M_Hines", "Soma3.gk_StochKv_det(0.5)*1e-4", 2, 1, 0.8, 0.9, 2)
        GraphWin_2.addexpr("BBP", "Soma4.gk_StochKv_bbp(0.5)*1e-4", 3, 1, 0.8, 0.9, 2)
        graphList[0].append(GraphWin_2)
    }

}

{run()}

strdef timeFilename

/*
f_Soma_v = new File()
strdef filename
{sprint(filename, "Soma.dat")}
f_Soma_v.wopen(filename)
Soma_v.printf(f_Soma_v)
f_Soma_v.close()



{ sprint(timeFilename, "%s",  "time.dat")}
{ f_time.wopen(timeFilename) }
{ v_time.printf(f_time) }
{ f_time.close() }

objref f_Soma_si
f_Soma_si = new File()
{ f_Soma_si.wopen("Soma.si.dat") }
for i=0, Soma_v.size()-1 {
   f_Soma_si.printf("%f\t%f\n", v_time.x[i]/1000, Soma_v.x[i]/1000)
}
{ f_Soma_si.close() }
*/



if (usegui==1) {
    //   This code pops up a simple Run Control

    {
    xpanel("RunControl", 0)
    v_init = -60.0
    xbutton("Init & Run","run()")
    xbutton("Stop","stoprun=1")
    t = 0
    xvalue("t","t", 2 )
    xvalue("Tstop","tstop", 1,"tstop_changed()", 0, 1 )
    dt = 0.01
     xvalue("dt","dt", 1,"setdt()", 0, 1 )
    xpanel(80,80)
    }
}

forall psection()
